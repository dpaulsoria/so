# How to do a Makefile
## Basic structure
The basic structure is as follows:  
```
target: prerequisite1 prerequisiten
    command1
    commandn   
```
**target**: Is usually the name of a file that is generated by a command.  
**prerequisite**: Is a file that is used as input to create the target. A target often depends on several files.  
**command**: Is an action that make carries out. A rule may have more than one command, each on its own line.  
Note: You have to put a single tab character at the beginning of every command line, spaces won't work out.
So we have an example:  
```
hw: hw.o helper.o
    gcc -o hw hw.o helper.o -lm

hw.o: hw.c
    gcc -O -Wall -c hw.c

helper.o: helper.c
    gcc -O -Wall -c helper.c

clean:
    rm -f hw.o helper.o hw
```

## What happen if you need to update an object file?
If hw.c has been modified more recently than hw.o has been created, *make* will know that hw.o is out of date and should be generate a new; in that case, it will execute the command line `gcc -O -Wall -c hw.c`.  
Which generates hw.o, thus if you are compiling a large program, make will know which object files need to be re-generated based on their dependencies, and *will only do the necessary amount of work to recreate the executable*.  
The object file (hw.o) will be created in the case that it doesn't exist at all.

## Useful Flags
To specify the executable name:
`gcc hw.c -o hw`  
Gives much better warnings:
`gcc hw.c -Wall`  
To enable debugging with gdb:
`gcc hw.c -g`  
To turn on optimization:
`gcc hw.c -O`  

## Separate Compilation
`gcc -Wall -O -c hw.c`  
`gcc -Wall -O -c helper.c`  
Linking them together:
`gcc -o hw hw.o helper.o -lm`

Note: Specify all the C source files on a single line to gcc is possible, but this requires the system to recompile every source-code-file *can be a lot of time-consuming process*

## Make clean

The clean target is used to remove the object files and executable, quite handy if you wish to rebuild the entire program from scratch.

## Useful Template 
```
# Makefile para compilar

# Definir el compilador y las opciones de compilacion
CC = gcc
CFLAGS = -Wall -O2

# Definir los archivos fuente y el archivo de salida
SRC = main.c # funciones.c
OBJ = $(SRC:.c=.o)
OUT = programa

# Regla predeterminada: compilar el programa

all: $(OUT)

# Regla para generar el programa ejecutable

$(OUT): $(OBJ)
	$(CC) $(OBJ) -o $(OUT)

# Regla para compilar los archivos fuente a objetos

%.o: %.c
	$(CC) $(CFLAGS) -c $< -o $@

# Limpieza: eliminar archivos objetos y el ejecutable

clean:
	rm -f $(OBJ) $(OUT)

```